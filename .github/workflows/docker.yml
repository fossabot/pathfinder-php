name: Docker

on:
  push:
    branches: [master]
  pull_request:
    branches: [master]

jobs:
  docker-tests:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Install Github Action Checkout
        uses: actions/checkout@v2

      - name: ğŸ“¥ Install Docker Layer Caching
        uses: satackey/action-docker-layer-caching@v0.0.11
        continue-on-error: true

      - name: ğŸ”¨ Build Application Image
        run: docker-compose build

      - name: ğŸ”¼ Run Application Containers (Detached Mode)
        run: docker-compose up -d

      - name: ğŸ’¤ Wait Application Containers to be ready
        uses: juliangruber/sleep-action@v1
        with:
          time: 5s

      - name: ğŸ” Check Docker Containers Status
        run: docker ps -a

      - name: ğŸ›‘ Stop Application Containers
        run: docker-compose down

      - name: ğŸ—‘ï¸ Prune unused Docker volumes and images
        run: |
          docker volume prune -f
          docker image prune -f
